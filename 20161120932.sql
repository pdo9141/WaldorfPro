DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Waldorf.Web.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201611210527580_Identity'
BEGIN
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201611210527580_Identity', N'Waldorf.Web.Migrations.Configuration',  0x1F8B0800000000000400DD5CDB6EDC36107D2FD07F10F4D416CECA9726488DDD04EEDA6E8DC617649DA46F0157E2AE8548942A51AE8DA25FD6877E527FA14389BAF1A2CBAEBCBB0E020416393C331C0EC9E170B8FFFDF3EFF8ED83EF19F7388ADD804CCC83D1BE696062078E4B961333A18B17AFCDB76FBEFD667CE6F80FC6C79CEE88D1414B124FCC3B4AC363CB8AED3BECA378E4BB7614C4C1828EECC0B790135887FBFB3F59070716060813B00C63FC3E21D4F571FA019FD380D838A409F22E03077B312F879A598A6A5C211FC721B2F1C4FC843C278816A34F783ECAA84DE3C473114832C3DEC2341021014514E43CFE10E3198D02B29C855080BCDBC71003DD027931E6F21F97E45DBBB27FC8BA62950D73283B8969E0F7043C38E2BAB1C4E62B69D82C7407DA3B032DD347D6EB548313F3C2C169D1FBC00305880C8FA75EC48827E665C1E2240EAF301DE50D4719E47904707F06D197511571CFE8DC6EAFB0A5C3D13EFBB7674C138F26119E109CD008797BC64D32F75CFB37FC781B7CC1647274305F1CBD7EF90A3947AF7EC4472FAB3D85BE025DAD008A6EA220C411C8861745FF4DC3AAB7B3C48645B34A9B4C2B604B302D4CE3123DBCC36449EF60C21CBE368D73F7013B790937AE0FC48559048D6894C0E755E27968EEE1A2DE6AE4C9FE6FE07AF8F2D5205CAFD0BDBB4C875EE00F13278279F51E7B696D7CE786D9F4AA8DF7674E761E053EFBAEDB5756FB79162491CD3A1368496E51B4C4B42EDDD82A8DB7934933A8E1CD3A47DD7DD36692CAE6AD24651D5A6526E42C363D1B72799F966F678B3B094318BCD4B498469A0C4EDEAC4642EB3DA342539ACE4157D321D0A5AF79253CF391EB0DB01476E0025EC8C28D7C5CF4F2E7000C0F91DE32DFA0388695C0F915C5770DA2C39F03883EC376128181CE28F2C327E7767317107C95F87366F79BE335D8D0DCFE199C239B06D11961ADD6C67B17D85F82849E11E71451FC81DA3920FBBC75FDEE0083887362DB388ECFC198B1330DC0C9CE012F083D3AEC0DC716A86DBB22530FB9BEDA171196D2CF3969E98FA829249F4443A6F24B9A447D172C5DD24DD49C542F6A46D12A2A27EB2B2A03EB2629A7D40B9A12B4CA99510DE6E9A52334BCAB97C2EEBEAFB7DEE6AD5B0B2A6A9CC10A897FC10447B08C393788521C917204BAAC1BDB7016D2E1634C9F7C6F4A397D445E3234AB956643BA080C3F1B52D8DD9F0DA998507CEF3ACC2BE97000CA8901BE13BDFA6CD53EE704C9363D1D6ADDDC34F3CDAC01BAE97212C781EDA6B34011FAE2818BBAFCE0C319ED518CAC376224043A0686EEB22D0F4AA06FA66854D7E4147B9862E3C4CE42835314DBC891D5081D727A0896EFA80AC1CA88485DB81F249E60E938628D103B04C530535D42E569E112DB0D91D7AA25A165C72D8CF5BDE021D69CE21013C6B055135D98AB03204C80828F30286D1A1A5B158B6B36448DD7AA1BF33617B61C77292EB1119B6CF19D3576C9FDB72731CC668D6DC0389B55D245006D306F1B06CACF2A5D0D403CB8EC9A810A27268D8172976A23065AD7D8160CB4AE926767A0D911B5EBF80BE7D55D33CFFA4179F3DB7AA3BAB6609B357DEC986966BE27B4A1D00247B2799ECE59257EA08AC319C8C9CF67317775451361E0334CEB219BD2DF55FAA156338868444D80A5A1B580F26B4009489A503D84CB63798DD2712FA2076C1E776B84E56BBF005BB10119BB7A1D5A21D45F9A8AC6D9E9F451F4ACB006C9C83B1D162A380A831017AF7AC73B284517979515D3C517EEE30D573AC607A341412D9EAB4649796706D7526E9AED5A5239647D5CB2B5B424B84F1A2DE59D195C4BDC46DB95A4700A7AB8056BA9A8BE850F34D9F24847B1DB1475632BCB92E205634B934E35BE4461E8926525BD8A9718B32CB76AFA62D63FE9C8CF302C3B56E41E15D2169C6810A125166A8135487AEE46313D4514CD118BF34C1D5F2253EEAD9AE53F6759DD3EE541CCF7819C9AFD9DB5505CDED7F65AD919E118E7D0439F793469185D31FEEAE6064B77431E8A1491FB69E0253ED13B58FAD6D9FD5DB57D5622238C2D417EC98192B425B9B975D5771A1879520C344885FFB2FA40E92174EACEBDCFAAC2751EA91E250F5055517441ABAD0D9CCE91E93558A28FD87FAC5A119E665EF1C4942A002FEA8951C96D90C02A75DD51EBE92755CC7A4D774421C7A40A2954F590B29A495213B25AB1129E46A36A8AEE1CE4DC912ABA5CDB1D59914552855654AF80AD9059ACEB8EAA4834A9022BAABB63975927E222BAC33B97F6E4B2F2D6951D6ED7DBBB34184FB3220EB3F555EEF0AB4095E29E58FC965E02E3E53B694DDA13DECAD694C534D6B3260D867EE5A9DD7ED7179EC62B7B3D66ED4ABBB6B8375DE9EBF1FAD9EC935A8674C013490AEEC5414F38D08DF9E1AAFD118D74DACA484C2357236CEC8F31C5FE88118C667F7853CFC56C19CF092E11711738A6591A8779B87F7028BCC3D99D3731561C3B9EE270AA7B18531FB30D6464917B14D9772892F323D6783752824AA1E70BE2E08789F957DAEA388D62B0BFD2E23DE322FE40DC3F12A8B88D126CFC2DE77B0E9347DF7CC8DAD1570FDDB57AF1FBE7ACE99E711DC18C3936F6055DAE32C2F5B710BDA4C99AAE21CDCA2F249EEF84AA3D3F50A20A1362F5D70673970EF2D22097F23B1F3D7CDF5734E56B82B510152F0686C21B4485BA1701AB60695F0338F049D3D700FD3AAB7E1DB08A68DA97012EE90F26BE0BE8BE0CE52DB7B8D528CE449B5892523DB7E655AF9564B9EDBD494ABF5E6BA2CB29D63DE0D648A35EC1329E5906F260BBA322C17830EC6D9AF6936715EF4A227199E2B1DDFCE14DA60C375C0B7D5599C23B90DBA6C8D5D97E3EF0A66D4D17C7DDF1A4CA7E59BF3B666C3C836BFBB9BD9B36365D9877C78DAD5706EF8ED9DAB6F6CF2D5B5AE72D74EBF9B8726A91E63E46150B6ECBB7CD02E770C29F0760049947993D935427783525A7B6302C49F44CF59965226369E2487C258A66B6FDFACA37FCC6CE729A66B69A7CCC26DE7CFD6FE4CD699A796BB21CB79129ACCC3354656FB7AC634D4950CF2933B8D6939644F4369FB5F172FD3925020FA294DAECD1DC113F9FBCDF415432E4D4E991E72B5FF7C2DE59F96545D8BF63775942B0DF5924D8AEED9A05CD055904F9E62D48949308119A4B4C91035BEA4944DD05B22954B31873FACE3B8DDBB19B8E39762EC87542C3844297B13FF76A012FE60434F14F9399EB328FAFC3F4274B86E80288E9B2D8FC35F939713DA790FB5C1113D24030EF824774D9585216D95D3E16485701E908C4D5573845B7D80F3D008BAFC90CDDE3556403F37B8797C87E2C23803A90F681A8AB7D7CEAA26584FC986394EDE1136CD8F11FDEFC0F9F5CD7C760540000 , N'6.1.3-40302')
END

